\documentclass[12pt, a4paper]{article}

\usepackage{listings}
\usepackage{xcolor}

% Setup the style
\lstset{
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{white},
    frame=single,
    breaklines=true
}

% --- BASIC SETUP ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{mathptmx}       % Times New Roman
\usepackage{geometry}
\geometry{top=2.54cm, bottom=2.54cm, left=2.54cm, right=2.54cm}

% --- FORMATTING ---
\setlength{\parindent}{0pt}
\setlength{\parskip}{12pt}
\linespread{1.15}

% --- PACKAGES ---
\usepackage{graphicx}
\usepackage{verbatim}       % Used for code blocks
\usepackage{hyperref}       % Links (Default settings, no colorlinks error)

% --- MANUAL ROMANIAN TITLES ---
\renewcommand{\contentsname}{Cuprins}
\renewcommand{\listfigurename}{Listă de figuri}
\renewcommand{\listtablename}{Listă de tabele}
\renewcommand{\refname}{Bibliografie}
\renewcommand{\figurename}{Figură}
\renewcommand{\tablename}{Tabel}

% --- METADATA ---
\title{\textbf{MyLast}\\ \large Documentație}
\author{Gaitur Ruslan}
\date{\today}

\begin{document}

\maketitle
\thispagestyle{empty}
\hrule
\vspace{1em}

\tableofcontents
\newpage

\section{Prezentare Generală}

\textbf{MyLast} este un script Bash conceput pentru a analiza jurnalele de autentificare ale sistemului situate în \texttt{/var/log/}. Acesta reproduce funcționalitatea comenzilor Linux standard \texttt{last} și \texttt{lastb}.

Scriptul ia date din fișierele \texttt{auth.log.x} (inclusiv cele comprimate cu gzip) pentru a reconstrui istoricul sesiunilor utilizatorilor fizici și a identifica încercările de autentificare eșuate.

\section{Caracteristici Principale}
\begin{itemize}
    \item \textbf{Procesare Jurnale:} Citește și concatenează \texttt{auth.log}, \texttt{auth.log.1}, etc.
    \item \textbf{Reconstruirea Sesiunii:} Reconstruieste exact firul de autentificare, deconectare al userului si shutdown al sistemului.
    \item \textbf{Reconstruirea Esecurilor de Logare:} Determina sesiunile in care au avut loc esecuri de autentificare.
    \item \textbf{Filtrare:} Permite filtrarea rezultatelor după constrângeri de timp specifice (De la, Până la, Prezent), dar la fel și după numărul de afișări.
\end{itemize}

\section{Instalare și Cerințe}

\subsection{Dependințe}
Asigurați-vă că următoarele sunt instalate:
\begin{itemize}
    \item \texttt{bash} (Mediul Shell)
    \item \texttt{less} (Citirea fișierelor text și, in special, gzip)
    \item \texttt{awk}, \texttt{cut}, \texttt{grep} (Procesare text)
\end{itemize}

\subsection{Permisiuni}
Deoarece scriptul citește din \texttt{/var/log/auth.log}, necesită de obicei privilegii \textbf{root}.

\begin{lstlisting}[language=bash]
sudo ./mylast.sh [...]
\end{lstlisting}

\section{Utilizare}

Scriptul acceptă argumente în linia de comandă pentru a determina modul de operare și logica de filtrare.

\subsection{Sintaxă}

\begin{lstlisting}[language=bash]
./mylast.sh <mod> [flag\_filtrare] [valoare\_filtrare]
\end{lstlisting}


\subsection{Moduri de Apel \texttt{<mod>}}
Determină modul de analiză:

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Flag} & \textbf{Descriere} \\ \hline
\texttt{-l} & \textbf{Ultimile Logări:} Analizează sesiunile reușite. \\ \hline
\texttt{-lb} & \textbf{Logări Eșuate:} Analizează încercările eșuate. \\ \hline
\end{tabular}
\caption{Moduri Principale de Execuție}
\end{table}

\subsection{Opțiuni de Filtrare \texttt{[flag\_filtrare]}}
Acești parametri sunt valabili doar pentru modul \texttt{-l} de rulare al scriptului.

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Flag} & \textbf{Format} \\ \hline
\texttt{-n} & Afișează ultimele N intrări. \\ \hline
\texttt{-s} & Arată sesiunile \textbf{de la} data specificată. \\ \hline
\texttt{-t} & Arată sesiunile \textbf{până la} data specificată. \\ \hline
\texttt{-p} & Arată sesiunile \textbf{active} la timpul specificat. \\ \hline
\end{tabular}
\caption{Optiuni de Filtrare}
\end{table}

\subsection{Parametri de Filtrare \texttt{[valoare\_filtrare]}}
Reprezinta valoarea ce tine de filtrare. Fiecare flag de filtru are un format unic pentru propria valoare.

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Flag} & \textbf{Format} \\ \hline
\texttt{-n} & \textbf{<INT>} Accepta un Integer. \\ \hline
\texttt{-s} & \textbf{<YYYY-MM-DD-HH:mm>} Accepta format tipic date-time. \\ \hline
\texttt{-t} & \textbf{<YYYY-MM-DD-HH:mm>} Accepta format tipic date-time. \\ \hline
\texttt{-p} & \textbf{<YYYY-MM-DD-HH:mm>} Accepta formate tipic date-time. \\ \hline
\end{tabular}
\caption{Format Acceptat Pentru Parametrii Filtrarii}
\end{table}

\section{Arhitectura de Baza}

\subsection{Argumentul Fundamental al Tuturor Functiilor}
Scriptul definește o variabilă \texttt{SYSLOG} (\texttt{/var/log}) ce stocheaza locatia syslog-urilor. In continuare, următoarele fișiere sunt concatenate într-un singur string, care este redirectat spre funcțiile de baza \texttt{mylast/mylastb}:

\begin{lstlisting}[language=bash]
LOG1="$SYSLOG/auth.log"
LOG2="$SYSLOG/auth.log.1"
LOG3="$SYSLOG/auth.log.2.gz"
LOG4="$SYSLOG/auth.log.3.gz"
LOG5="$SYSLOG/auth.log.4.gz"
\end{lstlisting}

\subsection{\texttt{mylast}}

Funcția \texttt{mylast} implementează o mașină de stări pentru a urmări sesiunile utilizatorilor.

\begin{enumerate}
    \item \textbf{Detectare Autentificare:} Scanează după ``new session''.
    \item \textbf{Deconectare/Eliminare:} Scanează după ``removed session'' sau ``logged out''.
    \item \textbf{Oprire Sistem:} Dacă este detectat ``system is powering down'', toate sesiunile active sunt închise.
\end{enumerate}

Aceasta masina de stari este construita pe baza a 2 variabile: \\ \\ \textbf{Queue} coada - salveaza utilizatorii autentificati dar care inca nu au fost deconectati \\ \textbf{Session} sesiunea - salveaza utilizatorii conectati si deconectati ulterior. \\ \\
Scriptul parcurge syslog-urile linie dupa linie. Daca observa un nou utilizator, atunci acesta este salvat in queue. Daca acest utilizator este deconectat, atunci acesta este scos din queue si este salvat in session.

\subsection{\texttt{mylastb}}
Funcția \texttt{mylastb} proceseaza sesiunile in care utilizatorul a gresit parola. Cauta trivial linia, folosind \texttt{grep}, dupa sirul de caractere: "password check failed".

\section{Arhitectura Filtrelor}

\subsection{\texttt{-n, -s, -t, -p}}
Aceste filtre au o structura triviala, folosind totalitatea sesiunilor deja procesate de functia \texttt{mylast}. Se impart sesiunile distincte folosind de delimitatorul spatiu \texttt{(" ")} si verifica daca data si timpul corespund cerintelor filtrului \texttt{(s, t, p)}, inclusiv si numarul de sesiuni ce necesita afisate \texttt{(n)}.

\section{Arhitectura Ajutatoare}

\subsection{\texttt{get\_len}}
Foloseste comanda built-in "for" pentru a determina numarul de linii intr-un string delimitat prin spatii. \\ Foloseste la parcurgerea variabilelor Queue si Session.

\subsection{\texttt{get\_time}}
Parseaza linia de syslog si returneaza timpul in care s-a inregistrat linia respectiva de jurnal. \\ Foloseste la obtinerea timpului de autentificare al utilizatorului.

\subsection{\texttt{get\_date}}
Parseaza linia de syslog si returneaza data la care s-a inregistrat linia respectiva de jurnal. \\ Foloseste la obtinerea datii de autentificare a utlizatorului

\subsection{\texttt{get\_duration}}
Calculează diferența dintre timpul de început ($T_s$) și timpul de sfârșit ($T_e$). \\ Foloseste la formatarea finala a datelor despre timp pentru o sesiune incheiata a unui utilizator

\end{document}
