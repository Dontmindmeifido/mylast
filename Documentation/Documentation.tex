\documentclass[12pt, a4paper]{article}

\usepackage{listings}
\usepackage{xcolor}

% Setup the style
\lstset{
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{white},
    frame=single,
    breaklines=true
}

% --- BASIC SETUP ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{mathptmx}       % Times New Roman
\usepackage{geometry}
\geometry{top=2.54cm, bottom=2.54cm, left=2.54cm, right=2.54cm}

% --- FORMATTING ---
\setlength{\parindent}{0pt}
\setlength{\parskip}{12pt}
\linespread{1.15}

% --- PACKAGES ---
\usepackage{graphicx}
\usepackage{verbatim}       % Used for code blocks
\usepackage{hyperref}       % Links (Default settings, no colorlinks error)

% --- MANUAL ROMANIAN TITLES ---
\renewcommand{\contentsname}{Cuprins}
\renewcommand{\listfigurename}{Listă de figuri}
\renewcommand{\listtablename}{Listă de tabele}
\renewcommand{\refname}{Bibliografie}
\renewcommand{\figurename}{Figură}
\renewcommand{\tablename}{Tabel}

% --- METADATA ---
\title{\textbf{MyLast}\\ \large Documentație}
\author{Gaitur Ruslan}
\date{\today}

\begin{document}

\maketitle
\thispagestyle{empty}
\hrule
\vspace{1em}

\tableofcontents
\newpage

\section{Prezentare Generală}

\textbf{MyLast} este un script Bash conceput pentru a analiza jurnalele de autentificare ale sistemului situate în \texttt{/var/log/}. Acesta reproduce funcționalitatea comenzilor Linux standard \texttt{last} și \texttt{lastb}.

Scriptul ia date din fișierele \texttt{auth.log.x} (inclusiv cele comprimate cu gzip) pentru a reconstrui istoricul sesiunilor utilizatorilor fizici și a identifica încercările de autentificare eșuate.

\section{Caracteristici Principale}
\begin{itemize}
    \item \textbf{Procesare Jurnale:} Citește și concatenează \texttt{auth.log}, \texttt{auth.log.1}, etc.
    \item \textbf{Reconstruirea Sesiunii:} Reconstruieste exact firul de autentificare, deconectare al userului si shutdown al sistemului.
    \item \textbf{Reconstruirea Esecurilor de Logare:} Determina sesiunile in care au avut loc esecuri de autentificare.
    \item \textbf{Filtrare:} Permite filtrarea rezultatelor după constrângeri de timp specifice (De la, Până la, Prezent), dar la fel și după numărul de afișări.
\end{itemize}

\section{Instalare și Cerințe}

\subsection{Dependințe}
Asigurați-vă că următoarele sunt instalate:
\begin{itemize}
    \item \texttt{bash} (Mediul Shell)
    \item \texttt{less} (Citirea fișierelor text și, in special, gzip)
    \item \texttt{awk}, \texttt{cut}, \texttt{grep} (Procesare text)
\end{itemize}

\subsection{Permisiuni}
Deoarece scriptul citește din \texttt{/var/log/auth.log}, necesită de obicei privilegii \textbf{root}.

\begin{lstlisting}[language=bash]
sudo ./mylast.sh [...]
\end{lstlisting}

\section{Utilizare}

Scriptul acceptă argumente în linia de comandă pentru a determina modul de operare și logica de filtrare.

\subsection{Sintaxă}

\begin{lstlisting}[language=bash]
./mylast.sh <mod> [flag_filtrare] [valoare_filtrare]
\end{lstlisting}


\subsection{Moduri de Apel \texttt{<mod>}}
Determină modul de analiză:

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Flag} & \textbf{Descriere} \\ \hline
\texttt{-l} & \textbf{Ultimile Logări:} Analizează sesiunile reușite. \\ \hline
\texttt{-lb} & \textbf{Logări Eșuate:} Analizează încercările eșuate. \\ \hline
\end{tabular}
\caption{Moduri Principale de Execuție}
\end{table}

\subsection{Opțiuni de Filtrare \texttt{[flag\_filtrare]}}
Acești parametri sunt valabili doar pentru modul \texttt{-l} de rulare al scriptului.

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Flag} & \textbf{Format} \\ \hline
\texttt{-n} & Afișează ultimele N intrări. \\ \hline
\texttt{-s} & Arată sesiunile \textbf{de la} data specificată. \\ \hline
\texttt{-t} & Arată sesiunile \textbf{până la} data specificată. \\ \hline
\texttt{-p} & Arată sesiunile \textbf{active} la timpul specificat. \\ \hline
\end{tabular}
\caption{Optiuni de Filtrare}
\end{table}

\subsection{Parametri de Filtrare \texttt{[valoare\_filtrare]}}
Reprezinta valoarea ce tine de filtrare. Fiecare flag de filtru are un format unic pentru propria valoare.

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|}
\hline
\textbf{Flag} & \textbf{Format} & \textbf{Descriere} \\ \hline
\texttt{-n} & \textbf{INT} & Numar intreg \\ \hline
\texttt{-s} & \textbf{YYYY-MM-DD-HH:mm} & Data si timp \\ \hline
\texttt{-t} & \textbf{YYYY-MM-DD-HH:mm} & Data si timp \\ \hline
\texttt{-p} & \textbf{YYYY-MM-DD-HH:mm} & Data si timp \\ \hline
\end{tabular}
\caption{Format Acceptat Pentru Parametrii Filtrarii}
\end{table}

\subsection{Interfata Grafica}

Deși \textbf{MyLast} este o aplicație bazată pe linia de comandă, interfața sa vizuală este definită de formatarea strictă a datelor returnate la \textit{Standard Output}. Interacțiunea grafică are loc exclusiv în cadrul terminalului.

\subsubsection{Arhitectura Interfetei}
Scriptul utilizează un \textit{layout tabular bazat pe text} pentru a reprezenta datele. Structura vizuală este proiectată pentru lizibilitate maximă, asemenea comenzilor \texttt{last, lastb}.

Fiecare linie afișată reprezintă o entitate distincta și este împărțită în coloane vizuale delimitate prin spațiere dinamică:

\subsubsection{Diagrama de Afișare}
Fluxul vizual al datelor urmează o structura tabelara, pentru fiecare obiect de date:

\begin{verbatim}
|--------------------------------------------------------------|
|Utilizator|Sesiune|   Data   |Ore de Inceput si Sfarsit|Durată|
|----------|-------|----------|-------------------------|------|
| student1 |  c2   |2025-12-01|     12:30-14:49         |(2:19)|
| student2 |  c3   |2025-12-01|     12:12-14:30         |(2:18)|
|--------------------------------------------------------------|
\end{verbatim}



\subsection{Exemple}

\subsubsection{Utilizare de Baza (Modul \texttt{-l,-lb})}

Afișarea tuturor sesiunilor reușite (-l)
\begin{lstlisting}[language=bash]
sudo ./mylast.sh -l
\end{lstlisting}

Afișarea încercărilor de autentificare eșuate (-lb)
\begin{lstlisting}[language=bash]
sudo ./mylast.sh -lb
\end{lstlisting}

\subsubsection{Utilizare cu Filtre (Modul \texttt{-l})}

Limitarea numărului de intrări (-n)
\begin{lstlisting}[language=bash]
sudo ./mylast.sh -l -n 5
\end{lstlisting}

Filtrare după data de început (-s)
\begin{lstlisting}[language=bash]
sudo ./mylast.sh -l -s 2023-12-01-12:00
\end{lstlisting}

Filtrare după data de sfârșit (-t)
\begin{lstlisting}[language=bash]
sudo ./mylast.sh -l -t 2024-01-15-23:59
\end{lstlisting}

Verificarea prezenței la un moment dat (-p)
\begin{lstlisting}[language=bash]
sudo ./mylast.sh -l -p 2023-12-25-14:30
\end{lstlisting}

\section{Arhitectura Functionalitatii}

\subsection{Arhitectura Functiilor de Baza}

\subsubsection{Argumentul Fundamental al Functiilor}
Scriptul definește o variabilă \texttt{SYSLOG} (\texttt{/var/log}) ce stocheaza locatia system log-urile. In continuare, următoarele fișiere sunt concatenate într-un singur string, care este redirectat spre funcțiile de baza \texttt{mylast/mylastb}:

\begin{lstlisting}[language=bash]
LOG1="$SYSLOG/auth.log"
LOG2="$SYSLOG/auth.log.1"
LOG3="$SYSLOG/auth.log.2.gz"
LOG4="$SYSLOG/auth.log.3.gz"
LOG5="$SYSLOG/auth.log.4.gz"
\end{lstlisting}

\subsubsection{\texttt{mylast}}

Funcția \texttt{mylast} implementează o mașină de stări pentru a urmări sesiunile utilizatorilor.

\begin{enumerate}
    \item \textbf{Detectare Autentificare:} Scanează după ``new session''.
    \item \textbf{Deconectare/Eliminare:} Scanează după ``removed session'' sau ``logged out''.
    \item \textbf{Oprire Sistem:} Dacă este detectat ``system is powering down'', toate sesiunile active sunt închise.
\end{enumerate}

Aceasta masina de stari este construita pe baza a 2 variabile: \\ \\ \textbf{Queue} coada - salveaza utilizatorii autentificati dar care inca nu au fost deconectati \\ \textbf{Session} sesiunea - salveaza utilizatorii conectati si deconectati ulterior. \\ \\
Scriptul parcurge system log-urile linie dupa linie. Daca observa un nou utilizator, atunci acesta este salvat in queue. Daca acest utilizator este deconectat, atunci acesta este scos din queue si este salvat in session.

\subsubsection{\texttt{mylastb}}
Funcția \texttt{mylastb} proceseaza sesiunile in care utilizatorul a gresit parola. Functionalitatea de baza este asigurata de \texttt{grep} dupa sirul de caractere: "password check failed".

\subsection{Arhitectura Functiilor de Filtrare}

\subsubsection{\texttt{-n, -s, -t, -p}}
Folosind totalitatea sesiunilor deja procesate de functia \texttt{mylast}, verifica daca data si timpul corespund cerintelor filtrului \texttt{(s, t, p)}, inclusiv si numarul de sesiuni ce necesita afisate \texttt{(n)}.

\subsection{Arhitectura Functiilor Ajutatoare}

\subsubsection{\texttt{get\_len}}
Determina numarul de linii intr-un string delimitat prin spatii. Foloseste la parcurgerea variabilelor \textbf{Queue} si \textbf{Session}.

\subsubsection{\texttt{get\_time}}
Parseaza linia de system log si returneaza timpul in care s-a inregistrat linia respectiva de jurnal. Foloseste la obtinerea timpului de autentificare al utilizatorului.

\subsubsection{\texttt{get\_date}}
Parseaza linia de system log si returneaza data la care s-a inregistrat linia respectiva de jurnal. Foloseste la obtinerea datii de autentificare a utlizatorului

\subsubsection{\texttt{get\_duration}}
Calculează diferența dintre timpul de început ($T_s$) și timpul de sfârșit ($T_e$) al unei sesiuni. Foloseste la formatarea finala a datelor despre timp pentru o sesiune incheiata a unui utilizator.

\end{document}
